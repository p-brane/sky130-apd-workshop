# sky130-apd-workshop

Results for Jay Morreale for the VSD Advanced Physical Design Course held Aug 2-6.

[TOC]

## Day 1

### Start openLANE
The flowing sequence is the is used to run an interactive OpenLANE flow to synthesis the picorv32a design.

```
cd ~/Desktop/work/tools/openlane_working_dir/openlane
docker
./flow.tcl -interactive
package require openlane 0.9
prep -design picorv32a
run_synthesis
```
The figure below shows the first step.

* ![](assets/sky130_pd_lab_01_noted-da8234e6.png)
* ![](assets/sky130_pd_lab_01_noted-09e8873b.png)

### Synthesis

* ![](assets/sky130_pd_lab_01_noted-5d72c0ab.png)

The Flop ratio from 1-yosys_4.stat.rpt is 1613/14876=0.1084

The buffer (buf1) ratio is 1656/14876=0.1113

## Day 2

### Floorplan Generation
The next step is to create a floorplan for the picorv32a design.

`run_floorplan`

The details of the configuration variable are located in '/home/p-brane/Desktop/work/tools/openlane_working_dir/openlane/configuration/README.md‌‌' under the Floorplanning section. Each variable is shown, defined and a default value is defined. Some of the floorplanning variable are shown in the figure below.

![](assets/sky130_apd_workshop_day2_lab1_results-0793bd3d.png)

The default values can be change in the floorplan.tcl file. Some of the floorplan.tcl is shown in the figure below.

![](assets/sky130_apd_workshop_day2_lab1_results-f2256850.png)

The floorplan.tch file places the horizontal metal on layer 3 which is metal4 and the vertical metal on layer 4 which is metal5. The metal layer stack is shown in the figure below.

![](assets/sky130_apd_workshop_day2_lab1_results-6f24db54.png)

The run_floorplan runs for a while and indicate a successful completion.

![](assets/sky130_apd_workshop_day2_lab1_results-20b5e7e9.png)

The log file ioPlaer.log from the floorplan are found at `/home/p-brane/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/runs/03-08_02-33/logs/floorplan/`

![](assets/sky130_apd_workshop_day2_lab1_results-c604f3c5.png)

The ioPlacer.log file contains the following info.

```
‌‌OpenROAD 0.9.0 1415572a73
This program is licensed under the BSD-3 license. See the LICENSE file for details.
Components of this program may be licensed under more restrictive licenses which must be honored.
Notice 0: Reading LEF file:  /openLANE_flow/designs/picorv32a/runs/03-08_02-33/tmp/merged.lef
Notice 0:     Created 13 technology layers
Notice 0:     Created 25 technology vias
Notice 0:     Created 440 library cells
Notice 0: Finished LEF file:  /openLANE_flow/designs/picorv32a/runs/03-08_02-33/tmp/merged.lef
Notice 0:
Reading DEF file: /openLANE_flow/designs/picorv32a/runs/03-08_02-33/tmp/floorplan/3-verilog2def_openroad.def
Notice 0: Design: picorv32a
Notice 0:     Created 409 pins.
Notice 0:     Created 14876 components and 115597 component-terminals.
Notice 0:     Created 14978 nets and 56051 connections.
Notice 0: Finished DEF file: /openLANE_flow/designs/picorv32a/runs/03-08_02-33/tmp/floorplan/3-verilog2def_openroad.def
#Macro blocks found: 0
Using 5u default boundaries offset
Random pin placement
RandomMode Even
```

The default config.tcl and default sky130A_sky130_fd_sc_hd_config.tcl file were used for this floorplan run. The configuration files are located at `/home/p-brane/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/`

![](assets/sky130_apd_workshop_day2_lab1_results-70d94a3c.png)

The picov32a.def file contains the floorplan results and is located at `/home/p-brane/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/runs/03-08_06-01/results/floorplan/`. The total die area is 660685 by 671405 units and can be converter to microns by dividing 1000 (1 micron = 1000 units).

![](assets/sky130_apd_workshop_day2_lab1_results-9b1ceaef.png)

### Floorplan Layout with Magic

Magic will display the floorplan layout graphically. Magic is invoked as using the following command in a new terminal.

`magic -T /home/p-brane/Desktop/work/tools/openlane_working_dir/pdks/sky130A/libs.tech/magic/sky130A.tech lef read /home/p-brane/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/runs/03-08_06-01/tmp/merged.lef def read /home/p-brane/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/runs/03-08_06-01/results/floorplan/picov32a.floorplan.def &`

The sky130A.tech file describes the Skywater 130 nm process and the picov32a.floorplan.def file contain the floorplan for the picorv32a design generated by the run_floorplan script.

![](assets/sky130_apd_workshop_day2_lab1_results-e2cbacff.png)
![](assets/sky130_apd_workshop_day2_lab1_results-8e63b358.png)

The Layout appears.
![](assets/sky130_apd_workshop_day2_lab1_results-d4123476.png)
![](assets/sky130_apd_workshop_day2_lab1_results-d33013ea.png)

To zoom, left mouse click and then right mouse click to form a rectangle and press `z` to zoom. Hover over a cell and press 's' to select and the tkcon window will show the status of the cell. The standard cells are located in the lower left corner.

![](assets/sky130_apd_workshop_day2_lab1_results-57dfeee4.png)

An error occurred so run_synthesis and run_placement error run again.

![](assets/sky130_apd_workshop_day2_lab1_results-9c08a1e3.png)

The magic command becomes

`magic -T /home/p-brane/Desktop/work/tools/openlane_working_dir/pdks/sky130A/libs.tech/magic/sky130A.tech lef read /home/p-brane/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/runs/04-08_06-57/tmp/merged.lef def read /home/p-brane/Desktop/work/tools/openlane_working_dir/openlane/designs/picorv32a/runs/04-08_06-57j/results/floorplan/picorv32a.floorplan.def &`

Magic now shows the status of the standard cells, there may still be an error.

![](assets/sky130_apd_workshop_day2_lab1_results-5ed1fb95.png)

### Placement

To place the standard cells run 'run_placement'.

![](assets/sky130_apd_workshop_day2_lab1_results-83a009ec.png)
![](assets/sky130_apd_workshop_day2_lab1_results-f8b39466.png)

## Day 3

### CMOS Inverter Standard Cell

Download the vsdstdcelldesign from GitHub to the openlane directory. This can be accomplished using the following commands

`cd /home/Desktop/work/tools/openlane_working_dir/openlane`
`git clone https://github.com/nickson-jose/vsdstdcelldesign.git`

![](assets/sky130_apd_workshop_day3_lab1_results-34b60ffb.png)

Move into the vsdstdcelldesign directory and copy the sky130A.tech file to the vsdstdcelldesign directory

`cd vsdstdcelldesign`
`cp /home/Desktop/work/tools/openlane_working_dir/pdks/sky130A/libs.tech/magic/sly130A.tech  .`

![](assets/sky130_apd_workshop_day3_lab1_results-2000f042.png)

### Inverter Layout in Magic

Run magic using `magic -d XR -T sky130A.tech sky130_inv.mag&` The -d XR setting use a different graphics system and produces a clearer window.

![](assets/sky130_apd_workshop_day3_lab1_results-b1507618.png)

### Extracted SPICE Netlist

To extract a spice netlist, then the parasitic capacitance and resistance.

```
extract all
ext2spice cthresh 0 rthresh 0
ext2spice
```

![](assets/sky130_apd_workshop_day3_lab1_results-810208a2.png)

This generates teh sky130_inv.ext and sky130_inv.spice files.

![](assets/sky130_apd_workshop_day3_lab1_results-2431da87.png)

sky130_inv.ext file
```
timestamp 1600540370
version 8.3
tech sky130A
style ngspice()
scale 1000 1 1e+06
resistclasses 2200000 3050000 1700000 3050000 120000 197000 114000 191000 120000 197000 114000 191000 48200 319800 2000000 48200 48200 12200 125 125 47 47 29 5
parameters sky130_fd_pr__nfet_01v8 l=l w=w a1=as p1=ps a2=ad p2=pd
parameters sky130_fd_pr__pfet_01v8 l=l w=w a1=as p1=ps a2=ad p2=pd
port "Y" 2 96 121 131 164 li
port "A" 1 10 121 45 164 li
port "VPWR" 3 44 258 90 289 m1
port "VGND" 5 50 -3 105 26 m1
node "Y" 474 347.122 96 121 li 0 0 0 0 0 0 0 0 1435 152 1443 152 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 5951 544 0 0 0 0 0 0 0 0 0 0 0 0
node "A" 462 409.094 10 121 li 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 7322 578 0 0 2295 192 0 0 0 0 0 0 0 0 0 0 0 0
node "VPWR" 2717 828.259 44 258 m1 0 0 0 0 33630 734 0 0 2950 286 1517 156 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6865 546 8496 450 0 0 0 0 0 0 0 0 0 0
substrate "VGND" 0 0 50 -3 m1 0 0 0 0 0 0 0 0 1365 148 2574 278 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 6941 498 8064 432 0 0 0 0 0 0 0 0 0 0
cap "VPWR" "A" 66.0605
cap "VPWR" "Y" 106.092
cap "A" "Y" 45.4865
device msubckt sky130_fd_pr__nfet_01v8 49 41 50 42 l=23 w=35 "VGND" "A" 46 0 "VGND" 35 0 "Y" 35 0
device msubckt sky130_fd_pr__pfet_01v8 49 196 50 197 l=23 w=37 "VPWR" "A" 46 0 "VPWR" 37 0 "Y" 37 0
subcap "Y" -107.681
subcap "A" -45.9469
subcap "VPWR" -243.219
subcap "VGND" -109.355
```
sky130_inv.spice file
```
* SPICE3 file created from sky130_inv.ext - technology: sky130A

.option scale=10000u

.subckt sky130_inv A Y VPWR VGND
X0 Y A VGND VGND sky130_fd_pr__nfet_01v8 ad=0 pd=0 as=0 ps=0 w=35 l=23
X1 Y A VPWR VPWR sky130_fd_pr__pfet_01v8 ad=0 pd=0 as=0 ps=0 w=37 l=23
C0 Y A 0.05fF
C1 VPWR A 0.07fF
C2 Y VPWR 0.11fF
C3 Y VGND 0.24fF
C4 VPWR VGND 0.59fF
.ends
```
### Spice Deck

Update the sky130_inv.spice file to use the correct scaling factor and models. From the tkcon the root cell box is 0.01 x 0.01 microns. The scale is change to `.option scale =0.01u'

![](assets/sky130_apd_workshop_day3_lab1_results-c74458c3.png)

Updated SPICE Netlist

```
‌‌* SPICE3 file created from sky130_inv.ext - technology: sky130A

.option scale=0.01u
.include ./libs/nshort.lib
.include ./libs/pshort.lib

//.subckt sky130_inv A Y VPWR VGND
M0 Y A VGND VGND nshort_model.0 ad=0 pd=0 as=0 ps=0 w=35 l=23
M1 Y A VPWR VPWR pshort_model.0 ad=0 pd=0 as=0 ps=0 w=37 l=23
VDD VPWR 0 3.3V
VSS VGND 0 0V
Va A VGND PULSE(0V 3.3V 0 0.1n 0.1n 2ms 4m)
C0 Y A 0.05fF
C1 VPWR A 0.07fF
C2 Y VPWR 0.11fF
C3 Y VGND 0.24fF
C4 VPWR VGND 0.59fF
//.ends
.tran 1n 20m
.control
run
.endc
.end
```
### SPICE Simulation

Simulate the SPICE deck using 'ngspice sky130_inv.spice'

![](assets/sky130_apd_workshop_day3_lab1_results-099cefbf.png)

Then plot the results `plot y vs time a`

![](assets/sky130_apd_workshop_day3_lab1_results-d200084f.png)


## Day 4

## Day 5
